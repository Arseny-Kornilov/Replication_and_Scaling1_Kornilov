# Домашнее задание к занятию "SQL. Часть 2" - `Корнилов Арсений`
---
### Задание 1.
Напишите запрос к учебной базе данных, который вернёт процентное соотношение общего размера всех индексов к общему размеру всех таблиц.
<img width="956" height="228" alt="image" src="https://github.com/user-attachments/assets/1f7b83ac-7216-40ad-af1f-0d72d20c7a05" />


### Задание 2.
Выполните запрос explain analyze для следующего запроса:

выберите distinct concat(c.last_name, ' ', c.first_name), sum(p.сумма) поверх (разделение по c.customer_id, f.заголовок)
из платёжной системы p, системы аренды r, клиентской системы c, системы инвентаризации i, системы фильмов f
где дата(p.дата_платежа) = '30.07.2005' и p.дата_платежа = r.дата_аренды и r.идентификатор_клиента = c.идентификатор_клиента и i.идентификатор_инвентаризации = r.идентификатор_инвентаризации
<img width="1716" height="317" alt="image" src="https://github.com/user-attachments/assets/78f58700-2272-4da4-a86c-6d00148a456e" />

#### - перечислите узкие места;
ОТВЕТ: Inner hash join (no condition) - соединение без условия между таблицами
rows=642000 loops=1 - обрабатывается 642,000 строк (слишком много)
Nested loop inner join с большим количеством строк - неэффективные вложенные циклы
Window aggregate with buffering - дорогая оконная функция над огромным набором данных
Отсутствуют подходящие индексы для условий фильтрации

#### - оптимизируйте запрос: внесите изменения в использование операторов, при необходимости добавьте индексы.
<img width="1175" height="1133" alt="image" src="https://github.com/user-attachments/assets/596b22bb-7151-470a-b278-4574b2147305" />
